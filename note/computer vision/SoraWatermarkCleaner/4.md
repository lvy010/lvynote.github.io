# ç¬¬4ç« ï¼šSoraWMï¼ˆæ°´å°æ¸…é™¤ä¸»æ¨¡å—ï¼‰

åœ¨å‰å‡ ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ„å»ºäº†å¼ºå¤§çš„å·¥å…·é“¾ï¼š
* [è§†é¢‘åŠ è½½å™¨](01_videoloader_.md)ï¼šé€å¸§æå–è§†é¢‘ç”»é¢çš„"æ•°å­—æ’­æ”¾å™¨"ï¼ˆffmegï¼‰
* [Soraæ°´å°æ£€æµ‹å™¨](02_sorawatermarkdetector_.md)ï¼šç²¾å‡†å®šä½æ°´å°çš„"AIä¾¦æ¢"ï¼ˆyoloï¼‰
* [æ°´å°æ¸…é™¤å™¨](03_watermarkcleaner_.md)ï¼šæ™ºèƒ½ä¿®å¤ç”»é¢çš„"æ•°å­—ç”»å¸ˆ"ï¼ˆIOpaitsï¼ˆlamaï¼‰ï¼‰

ç°åœ¨é¢ä¸´çš„é—®é¢˜æ˜¯ï¼šå¦‚ä½•è‡ªåŠ¨åŒ–å¤„ç†**å®Œæ•´è§†é¢‘**ï¼Ÿ

`SoraWM`å°±æ˜¯è¿™ä¸ªæµç¨‹çš„"æ€»æŒ‡æŒ¥"ï¼Œèƒ½==æ™ºèƒ½è°ƒåº¦==å„ä¸ªæ¨¡å—ï¼Œå®Œæˆä»æ°´å°æ£€æµ‹åˆ°æœ€ç»ˆè§†é¢‘ç”Ÿæˆçš„==å…¨æµç¨‹==å¤„ç†ã€‚

## æ ¸å¿ƒåŠŸèƒ½

å®Œæ•´è§†é¢‘æ°´å°æ¸…é™¤åŒ…å«å¤šä¸ªå¤æ‚æ­¥éª¤ï¼š
1. **é€å¸§æ£€æµ‹**ï¼šå®šä½æ¯å¸§ç”»é¢ä¸­çš„æ°´å°ä½ç½®
2. **æ™ºèƒ½å¡«è¡¥**ï¼šå¯¹æ¼æ£€å¸§è¿›è¡Œä½ç½®é¢„æµ‹
3. **æ‰¹é‡ä¿®å¤**ï¼šå¯¹æ ‡è®°åŒºåŸŸæ‰§è¡Œä¿®å¤
4. **è§†é¢‘é‡å»º**ï¼šå°†ä¿®å¤åçš„å¸§é‡æ–°ç¼–ç ä¸ºè§†é¢‘
5. **éŸ³è½¨åˆå¹¶**ï¼šä¿ç•™åŸå§‹éŸ³é¢‘å¹¶åˆæˆåˆ°æ–°è§†é¢‘

> **æŠ€æœ¯æ–¹æ¡ˆï¼š** é€šè¿‡ä¸¤é˜¶æ®µå¤„ç†æµç¨‹ï¼ˆæ£€æµ‹+ä¿®å¤ï¼‰å’Œæ™ºèƒ½å¡«è¡¥ç®—æ³•ï¼Œç¡®ä¿é•¿è§†é¢‘å¤„ç†çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

## ä½¿ç”¨æŒ‡å—

### 1. åˆå§‹åŒ–æ¨¡å—

```python
from sorawm.core import SoraWM

processor = SoraWM()  # è‡ªåŠ¨åŠ è½½æ£€æµ‹å™¨å’Œæ¸…é™¤å™¨
print("æ°´å°æ¸…é™¤ç³»ç»Ÿå‡†å¤‡å°±ç»ªï¼")
```

### 2. æ‰§è¡Œå¤„ç†æµç¨‹

```python
from pathlib import Path

input_file = Path("è¾“å…¥è§†é¢‘.mp4")
output_file = Path("è¾“å‡ºè§†é¢‘_æ— æ°´å°.mp4")

# è¿›åº¦å›è°ƒå‡½æ•°ç¤ºä¾‹
def show_progress(percent):
    print(f"å¤„ç†è¿›åº¦: {percent}%")

processor.run(input_file, output_file, progress_callback=show_progress)
```

æ§åˆ¶å°å°†æ˜¾ç¤º~
```
æ£€æµ‹æ°´å°: 100%|â–ˆâ–ˆâ–ˆâ–ˆ| 300/300 [00:15<00:00]
ä¿®å¤æ°´å°: 100%|â–ˆâ–ˆâ–ˆâ–ˆ| 300/300 [01:02<00:00]
éŸ³é¢‘åˆå¹¶å®Œæˆï¼
```

## æŠ€æœ¯å®ç°

### ğŸ¢ä¸¤é˜¶æ®µå¤„ç†æµç¨‹

1. **æ£€æµ‹é˜¶æ®µ**ï¼š
   - éå†æ‰€æœ‰å¸§å¹¶è®°å½•æ°´å°ä½ç½®
   - å¯¹æ¼æ£€å¸§ä½¿ç”¨æ»‘åŠ¨çª—å£é¢„æµ‹ç®—æ³•å¡«è¡¥åæ ‡
   - ç”Ÿæˆæ°´å°ä½ç½®æ˜ å°„è¡¨

2. **ä¿®å¤é˜¶æ®µ**ï¼š
   - äºŒæ¬¡éå†è§†é¢‘å¸§
   - æ ¹æ®æ˜ å°„è¡¨åˆ›å»ºä¿®å¤æ©è†œ
   - è°ƒç”¨æ¸…é™¤å™¨è¿›è¡Œé€å¸§ä¿®å¤
   - é€šè¿‡FFmpegæµå¼å†™å…¥ä¸´æ—¶è§†é¢‘æ–‡ä»¶

3. **åå¤„ç†é˜¶æ®µ**ï¼š
   - æå–åŸå§‹è§†é¢‘éŸ³è½¨
   - ä¸ä¿®å¤åè§†é¢‘åˆå¹¶
   - æ¸…ç†ä¸´æ—¶æ–‡ä»¶

```mermaid
sequenceDiagram
    ç”¨æˆ·ç¨‹åº->SoraWM: 1. æ‰§è¡Œrun()
    SoraWM->è§†é¢‘åŠ è½½å™¨: 2. é¦–æ¬¡éå†(æ£€æµ‹)
    è§†é¢‘åŠ è½½å™¨->æ°´å°æ£€æµ‹å™¨: 3. é€å¸§æ£€æµ‹
    æ°´å°æ£€æµ‹å™¨-->SoraWM: 4. è¿”å›åæ ‡æ•°æ®
    SoraWM->SoraWM: 5. å¡«è¡¥ç¼ºå¤±åæ ‡
    SoraWM->è§†é¢‘åŠ è½½å™¨: 6. äºŒæ¬¡éå†(ä¿®å¤)
    è§†é¢‘åŠ è½½å™¨->æ°´å°æ¸…é™¤å™¨: 7. é€å¸§ä¿®å¤
    æ°´å°æ¸…é™¤å™¨-->SoraWM: 8. è¿”å›ä¿®å¤å¸§
    SoraWM->FFmpeg: 9. æµå¼å†™å…¥è§†é¢‘
    SoraWM->FFmpeg: 10. åˆå¹¶éŸ³è§†é¢‘
    SoraWM-->ç”¨æˆ·ç¨‹åº: 11. è¿”å›æœ€ç»ˆæ–‡ä»¶
```

### æ ¸å¿ƒç®—æ³•

**æ™ºèƒ½å¡«è¡¥ç®—æ³•**ï¼š
```python
def impute_missing_bboxes(bbox_sequence):
    for i in range(len(bbox_sequence)):
        if bbox_sequence[i] is None:
            # å‘å‰æŸ¥æ‰¾æœ€è¿‘çš„æœ‰æ•ˆåæ ‡
            prev = next((b for b in bbox_sequence[:i][::-1] if b is not None), None)
            # å‘åæŸ¥æ‰¾æœ€è¿‘çš„æœ‰æ•ˆåæ ‡  
            next_ = next((b for b in bbox_sequence[i:] if b is not None), None)
            
            if prev and next_:
                # çº¿æ€§æ’å€¼è®¡ç®—ä¸­é—´åæ ‡
                bbox_sequence[i] = interpolate(prev, next_, i)
```

## æ€»ç»“

`SoraWM`ä½œä¸ºæ ¸å¿ƒè°ƒåº¦æ¨¡å—ï¼š
- å®ç°å…¨è‡ªåŠ¨åŒ–è§†é¢‘æ°´å°æ¸…é™¤
- é€šè¿‡==ä¸¤é˜¶æ®µå¤„ç†==ç¡®ä¿ç¨³å®šæ€§
- æ™ºèƒ½å¡«è¡¥ç®—æ³•æå‡å®¹é”™èƒ½åŠ›
- ä¿æŒåŸå§‹éŸ³è§†é¢‘è´¨é‡

ä¸‹ä¸€æ­¥å¯é€šè¿‡[FastAPIæœåŠ¡](05_fastapi_web_server_.md)å°†åŠŸèƒ½å¼€æ”¾ä¸ºç½‘ç»œæœåŠ¡ã€‚

