# 第5章：命令系统

欢迎回来

在前几章中，我们已经了解了[沙箱](01_sandbox_.md)的基础知识，以及如何通过[SDK](03_sdk__javascript_python__.md)和[CLI](04_cli__command_line_interface__.md)控制它。现在，我们将深入探索如何在沙箱中**执行命令**——这是与云端迷你计算机交互的核心方式。

## 命令系统的作用

命令系统允许我们：
- **运行代码**：执行Python脚本或Shell命令
- **安装依赖**：通过`pip install`等命令配置环境
- **操作系统交互**：管理文件、查看进程等

## 基础用法

### 执行简单命令

**JavaScript/TypeScript示例**：
```ts
import { Sandbox } from '@e2b/code-interpreter'

const sandbox = await Sandbox.create()
const proc = await sandbox.process.start({ cmd: 'ls -l' })
await proc.wait()
console.log('命令输出:', proc.output.stdout)
await sandbox.close()
```

**Python示例**：
```python
from e2b import Sandbox

with Sandbox() as sandbox:
    proc = sandbox.process.start(cmd='ls -l')
    proc.wait()
    print('命令输出:', proc.stdout)
```

### 实时输出流

**获取实时输出**：
```ts
const proc = await sandbox.process.start({
  cmd: 'echo "实时输出测试"',
  onStdout: (output) => console.log('实时:', output.line)
})
```

### 交互式命令

**发送输入**：
```python
proc = sandbox.process.start(
  cmd='read -p "请输入:" input && echo $input',
  stdin=True
)
proc.send_stdin('你好E2B!\n')
```

## 功能

| 功能           | 说明                     | 示例                    |
| -------------- | ------------------------ | ----------------------- |
| **后台进程**   | 不阻塞主程序执行         | `background=True`       |
| **终止进程**   | 强制结束长时间运行的任务 | `proc.kill()`           |
| **获取进程ID** | 追踪特定进程             | `console.log(proc.pid)` |

## 完整工作流

**运行AI生成的Python脚本**：
```ts
// 1. 保存AI生成的代码
await sandbox.filesystem.write('/main.py', 'print("AI生成内容")')

// 2. 执行脚本
const proc = await sandbox.process.start({
  cmd: 'python3 /main.py',
  onStdout: (output) => console.log('AI输出:', output.line)
})
await proc.wait()
```

## 技术原理

当执行命令时：
1. SDK通过WebSocket连接沙箱
2. 沙箱启动bash进程执行命令
3. 实时流式传输输出回本地
4. 通过进程句柄管理生命周期

```mermaid
sequenceDiagram
    用户代码->>SDK: 执行sandbox.process.start()
    SDK->>沙箱VM: 建立WebSocket连接
    沙箱VM->>Bash进程: 执行命令
    Bash进程-->>沙箱VM: 实时输出
    沙箱VM-->>SDK: 流式传输数据
    SDK->>用户代码: 触发onStdout回调
```

## 下一步

现在已掌握命令执行的核心方法，下一章将探索[文件系统操作](06_filesystem_operations_.md)

[下一章：文件系统操作](06_filesystem_operations_.md)

---
