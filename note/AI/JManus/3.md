# 第3章：AI代理系统

在[第2章：计划执行引擎](02_plan_execution_engine_.md)中，我们了解了JManus如何将"策划生日派对"这类复杂请求拆解为可执行步骤

但谁来完成这些具体任务？谁负责筛选场地、发送邀请函或安排餐饮？这正是**AI代理**的职责所在

## 专业化的AI执行团队

想象建造房屋时，总承包商（计划执行引擎）负责整体管理，而具体工作由电工、水管工、木匠等专业工种完成。JManus的**AI代理**正是这样的专业执行者：

- **浏览器代理**：精通网络搜索与信息提取
- **邮件代理**：擅长撰写和发送定制化邮件
- **文件管理代理**：高效处理文档读写
- **表单输入代理**：专门收集人工输入（见[第1章交互控制](01_interactive_task_control_.md)）

## 实战案例：派对规划

当执行"策划Sarah的30岁生日派对"计划时：

1. **日期确认代理**  
   使用日历工具检查Sarah的可用日期，必要时通过交互控制请求确认
   ```java
   public class DatePickerAgent extends ReActAgent {
       protected boolean think() {
           // 分析现有日历数据
           return needsHumanConfirm ? showForm() : autoConfirm();
       }
   }
   ```

2. **宾客管理代理**  
   从联系人库中提取潜在宾客名单：
   ```typescript
   interface GuestListTool {
     query: "Sarah的亲密好友";
     filters: ["同城", "近期互动"];
   }
   ```

3. **场地研究代理**  
   调用网络搜索工具获取场地信息：
   ```mermaid
   graph TD
     A[输入: 派对需求] --> B[网络搜索]
     B --> C[价格筛选]
     C --> D[生成TOP3推荐]
   ```

## 核心设计理念

### 1. 思考-行动模式（ReAct）

代理遵循标准化工作流：
1. **思考阶段**：分析当前状态，决定后续动作
2. **行动阶段**：调用专用工具执行操作
3. **循环迭代**：直到任务完成或达到最大步数

### 2. 工具即能力

代理通过工具集扩展能力边界：
```java
public class BrowserAgent extends DynamicAgent {
    @Override
    public List<ToolCallback> getToolCallList() {
        return Arrays.asList(
            new WebSearchTool(),
            new PageScraperTool()
        );
    }
}
```

### 3. 动态配置

代理行为可通过数据库配置实时调整：
```sql
INSERT INTO dynamic_agents 
(agent_name, description, tools) 
VALUES 
('EmailAgent', '邮件处理专家', 'sendEmail,readTemplates');
```

## 技术实现

### 基础代理类

```java
public abstract class BaseAgent {
    // 核心执行方法
    public String run() {
        while (!isDone()) {
            AgentExecResult result = step(); // 执行思考-行动循环
            if (result.state == FAILED) break;
        }
        return finalResult;
    }
    
    protected abstract AgentExecResult step();
}
```

### 动态代理实例化

计划执行引擎按需创建代理：
```java
public class DynamicToolPlanExecutor {
    protected BaseAgent createAgent(ExecutionStep step) {
        return new ConfigurableDynaAgent(
            step.getAgentName(),
            step.getTools() // 注入步骤指定的工具集
        );
    }
}
```

## 系统优势

1. **模块化扩展**  
   新增代理类型无需修改核心引擎代码

2. **执行可观测**  
   每个代理步骤记录详细日志：
   ```
   [2025-05-20 14:30] VenueAgent: 
   - ACTION: 调用WebSearchTool 
   - QUERY: "海滨餐厅 容纳50人"
   - RESULT: 获取12条结果
   ```

3. **资源隔离**  
   不同代理类型使用独立线程池，避免相互阻塞

## 总结

AI代理系统通过：
- **专业化分工**：每个代理专注特定领域
- **标准化协议**：统一的ReAct执行模式
- **动态装配**：运行时组合工具与能力

==实现复杂任务的精细化执行==。

接下来我们将探索如何通过[动态配置系统](04_dynamic_configuration_.md)灵活调整代理行为。

