# ç¬¬3ç« ï¼šTracy Workerï¼ˆæœåŠ¡å™¨ï¼‰

æ¬¢è¿å›æ¥

åœ¨[ç¬¬2ç« ï¼šTracy Clientï¼ˆæ’æ¡©ï¼‰](02_tracy_client__instrumentation__.md)ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°Tracy Clienté©»ç•™åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå†…éƒ¨ï¼Œå‹¤å¥‹åœ°ä»æˆ‘ä»¬çš„ä»£ç ä¸­æ”¶é›†åŸå§‹æ€§èƒ½æ•°æ®å¹¶å°†å…¶å‘é€å‡ºå»ã€‚

ä½†æ‰€æœ‰è¿™äº›åŸå§‹çš„ã€æœªå¤„ç†çš„æ•°æ®å»å“ªé‡Œäº†ï¼Ÿ

è¿™å°±æ˜¯**Tracy Worker**çš„ä½œç”¨

## ä»€ä¹ˆæ˜¯Tracy Workerï¼Ÿ

æƒ³è±¡ä¸€ä¸‹Tracy Clientå°±åƒä¸€æ”¯ç”±å¾®å°çš„ç°åœºè®°è€…ç»„æˆçš„å›¢é˜Ÿï¼Œä»æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å„ä¸ªéƒ¨åˆ†å‘æˆ‘ä»¬å‘é€æŒç»­çš„åŸå§‹ç¬”è®°æµã€‚è¿™äº›ç¬”è®°éå¸¸è¯¦ç»†ï¼Œä½†å®ƒä»¬åªæ˜¯åŸå§‹ç¬”è®°ã€æ—¶é—´æˆ³å’ŒIDã€‚æˆ‘ä»¬æ— æ³•ç›´æ¥ç†è§£å®ƒä»¬ã€‚

Tracy Workeræ˜¯è¿™äº›ç¬”è®°çš„"å¤§è„‘"æˆ–**ä¸­å¤®æ¡£æ¡ˆç®¡ç†å‘˜**ã€‚å®ƒæ˜¯ä¸€ä¸ªå•ç‹¬çš„ç¨‹åºï¼ˆæˆ–ä¸»Tracy Profiler GUIä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼‰ï¼Œåœ¨åå°è¿è¡Œã€‚å®ƒçš„å·¥ä½œæ˜¯ï¼š

1.  **ç›‘å¬ï¼š** ç­‰å¾…æ¥è‡ªä»»ä½•æ’æ¡©åº”ç”¨ç¨‹åºï¼ˆTracy Clientsï¼‰çš„ä¼ å…¥æ•°æ®ã€‚
2.  **æ¥æ”¶ï¼š** ä»ç½‘ç»œæ¥æ”¶åŸå§‹äºŒè¿›åˆ¶æ•°æ®æµã€‚
3.  **å¤„ç†ï¼š** è§£å¯†ã€ååºåˆ—åŒ–ï¼ˆä»åŸå§‹å­—èŠ‚è½¬æ¢ä¸ºæœ‰æ„ä¹‰çš„å¯¹è±¡ï¼‰å¹¶é«˜æ•ˆåœ°ç»„ç»‡è¿™äº›æ•°æ®ã€‚
4.  **å­˜å‚¨ï¼š** å°†è¿™äº›ç»„ç»‡å¥½çš„æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä½¿å…¶å‡†å¤‡å¥½ä¾›[Tracy Viewï¼ˆåˆ†æå™¨GUIï¼‰](01_tracy_view__profiler_gui__.md)æŸ¥è¯¢æˆ–ä¿å­˜åˆ°æ–‡ä»¶ã€‚

**å®ƒè§£å†³çš„ä¸»è¦é—®é¢˜ï¼š** ==ç†è§£==åŸå§‹çš„ã€ä¼ å…¥çš„æ€§èƒ½æ•°æ®ï¼Œå¹¶å°†å…¶==ç»„ç»‡==æˆä¸€ä¸ªè¿è´¯çš„ã€å¯æœç´¢çš„æ•°æ®åº“ã€‚æ²¡æœ‰Workerï¼ŒåŸå§‹å®¢æˆ·ç«¯æ•°æ®å°†æ— æ³•ä½¿ç”¨

## æˆ‘ä»¬çš„æ ¸å¿ƒç”¨ä¾‹ï¼šå°†å®æ—¶æ€§èƒ½åˆ†ææ•°æ®æ•è·åˆ°æ–‡ä»¶

å‡è®¾æˆ‘ä»¬æ­£åœ¨è¿è¡Œæˆ‘ä»¬çš„æ¸¸æˆï¼Œå…¶ä¸­çš„Tracy Clientæ­£åœ¨ä¸»åŠ¨å‘é€æ€§èƒ½æ•°æ®ã€‚æˆ‘ä»¬æƒ³è¦åœ¨==ç‰¹å®šæŒç»­æ—¶é—´å†…`æ•è·`è¿™äº›æ•°æ®å¹¶å°†å…¶`ä¿å­˜åˆ°.tracy`æ–‡ä»¶ä¸­==ï¼Œä»¥ä¾¿æˆ‘ä»¬ç¨åå¯ä»¥ä½¿ç”¨[Tracy Viewï¼ˆåˆ†æå™¨GUIï¼‰](01_tracy_view__profiler_gui__.md)åˆ†æå®ƒï¼ˆå¯èƒ½åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼‰ã€‚

æœ¬ç« å°†æŒ‡å¯¼æˆ‘ä»¬ç†è§£Tracy Workerï¼ˆç‰¹åˆ«æ˜¯`tracy-capture`å®ç”¨ç¨‹åºï¼‰å¦‚ä½•ä½¿è¿™æˆä¸ºå¯èƒ½ã€‚

## ğŸ¢Tracy Workerçš„å…³é”®æ¦‚å¿µ

è¦ç†è§£Tracy Workerå¦‚ä½•è¿ä½œï¼Œè®©æˆ‘ä»¬åˆ†è§£å…¶æ ¸å¿ƒåŠŸèƒ½ï¼š

1.  **æœåŠ¡å™¨è§’è‰²ï¼š** ==Workerå……å½“æœåŠ¡å™¨==ã€‚å®ƒæ‰“å¼€ä¸€ä¸ªç‰¹å®šçš„ç½‘ç»œç«¯å£ï¼Œè€å¿ƒç­‰å¾…Tracy Clientsè¿æ¥å¹¶å‘é€å®ƒä»¬çš„æ•°æ®ã€‚
2.  **æ•°æ®æµè§£é‡Šï¼š** æ¥è‡ªå®¢æˆ·ç«¯çš„æ•°æ®æ˜¯è¿ç»­çš„äºŒè¿›åˆ¶æ¶ˆæ¯æµï¼ˆå¦‚"zoneå¼€å§‹"ã€"zoneç»“æŸ"ã€"å†…å­˜åˆ†é…"ï¼‰ã€‚Workeræ™ºèƒ½åœ°==è§£æ==è¿™ä¸ªæµï¼Œç†è§£æ¯æ¡æ¶ˆæ¯çš„å«ä¹‰ã€‚
3.  **æ—¶é—´åŒæ­¥ï¼š** å®¢æˆ·ç«¯å¯èƒ½åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œæˆ–è€…å®ƒä»¬çš„å†…éƒ¨æ—¶é’Ÿå¯èƒ½æ¼‚ç§»ã€‚Workerå¸®åŠ©==åŒæ­¥æ—¶é—´æˆ³==ï¼Œä»¥ç¡®ä¿æ‰€æœ‰äº‹ä»¶éƒ½æ­£ç¡®æ”¾ç½®åœ¨ç»Ÿä¸€çš„æ—¶é—´è½´ä¸Šã€‚
4.  **é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼š** ä¸ºäº†å¤„ç†å¯èƒ½æ•°åäº¿çš„äº‹ä»¶ï¼ŒWorkerå°†å¤„ç†è¿‡çš„æ•°æ®å­˜å‚¨åœ¨==é«˜åº¦ä¼˜åŒ–çš„æ•°æ®ç»“æ„ä¸­==ï¼Œå…è®¸[Tracy View](01_tracy_view__profiler_gui__.md)è¿›è¡Œå¿«é€ŸæŸ¥è¯¢å’Œå¯¼èˆªã€‚

## è§£å†³ç”¨ä¾‹ï¼šä½¿ç”¨`tracy-capture`æ•è·

Tracyæä¾›äº†ä¸€ä¸ªåä¸º`tracy-capture`çš„å‘½ä»¤è¡Œå®ç”¨ç¨‹åºï¼Œå®ƒä½“ç°äº†Tracy Workerçš„æœåŠ¡å™¨è§’è‰²ï¼Œå…è®¸æˆ‘ä»¬æ•è·å®æ—¶æ€§èƒ½åˆ†ææ•°æ®ã€‚

### ç¤ºä¾‹ï¼šæ•è·è·Ÿè¸ª

é¦–å…ˆï¼Œç¡®ä¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼ˆåµŒå…¥äº†Tracy Clientï¼‰æ­£åœ¨è¿è¡Œã€‚ç„¶åï¼Œæ‰“å¼€æˆ‘ä»¬çš„ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦å¹¶è¿è¡Œ`tracy-capture`ã€‚

```bash
# åœ¨æˆ‘ä»¬çš„ç»ˆç«¯ä¸­ï¼Œå¯åŠ¨æ•è·å®ç”¨ç¨‹åº
tracy-capture -o my_game_session.tracy

# æ§åˆ¶å°ä¸­çš„é¢„æœŸè¾“å‡ºï¼š
# Connecting to 127.0.0.1:8086...
# Timer resolution: 1.00 ns
# ... (æ˜¾ç¤ºMbpsã€å‹ç¼©æ¯”ã€å†…å­˜ä½¿ç”¨çš„è¿›åº¦æ›´æ–°) ...
# (æŒ‰Ctrl+Cåœæ­¢æ•è·)
```

**è§£é‡Šï¼š**

*   `tracy-capture`ï¼šè¿™æ˜¯ä»¥ç‹¬ç«‹æ¨¡å¼è¿è¡ŒTracy Workerçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚
*   `-o my_game_session.tracy`ï¼šæ­¤æ ‡å¿—å‘Šè¯‰Workerå°†å®ƒæ¥æ”¶çš„æ‰€æœ‰æ€§èƒ½åˆ†ææ•°æ®ä¿å­˜åˆ°åä¸º`my_game_session.tracy`çš„æ–‡ä»¶ä¸­ã€‚
*   è¾“å‡º`Connecting to...`æ˜¾ç¤ºWorkeræ­£åœ¨å°è¯•è¿æ¥åˆ°å®¢æˆ·ç«¯ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨`127.0.0.1`å’Œç«¯å£`8086`ä¸Šï¼‰ã€‚
*   ä¸€æ—¦è¿æ¥ï¼Œå®ƒå°†æŒç»­æ˜¾ç¤ºæœ‰å…³æ•°æ®ä¼ è¾“å’Œå¤„ç†çš„å®æ—¶ç»Ÿè®¡ä¿¡æ¯ã€‚
*   å½“æˆ‘ä»¬æ”¶é›†äº†è¶³å¤Ÿçš„æ•°æ®åï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­æŒ‰`Ctrl+C`åœæ­¢æ•è·ã€‚ç„¶åWorkerå°†å®Œæˆå¹¶ä¿å­˜`.tracy`æ–‡ä»¶ã€‚

æ•è·å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨[Tracy View](01_tracy_view__profiler_gui__.md)æ‰“å¼€`my_game_session.tracy`æ¥åˆ†ææˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚

## åº•å±‚æœºåˆ¶ï¼šTracy Workerå¦‚ä½•å·¥ä½œ

è®©æˆ‘ä»¬çœ‹çœ‹Tracy Workerï¼ˆä½œä¸º`tracy-capture`è¿è¡Œæ—¶ï¼‰å¦‚ä½•è¿ä½œçš„ç®€åŒ–æµç¨‹ï¼š

### æµç¨‹

ä»¥ä¸‹æ˜¯æˆ‘ä»¬è¿è¡Œ`tracy-capture`æ—¶å‘ç”Ÿçš„äº‹æƒ…ï¼š

1.  **Workeråˆå§‹åŒ–ï¼š** æˆ‘ä»¬å¯åŠ¨`tracy-capture`å¹¶å‘Šè¯‰å®ƒåœ¨å“ªé‡Œä¿å­˜è¾“å‡ºæ–‡ä»¶ã€‚
2.  **ç½‘ç»œè®¾ç½®ï¼š** Tracy Workeråˆå§‹åŒ–å…¶ç½‘ç»œç»„ä»¶ï¼Œå¹¶å¼€å§‹åœ¨ç‰¹å®šç«¯å£ï¼ˆé»˜è®¤8086ï¼‰ä¸Šç›‘å¬[Tracy Client](02_tracy_client__instrumentation__.md)è¿æ¥ã€‚
3.  **å®¢æˆ·ç«¯è¿æ¥ï¼š** ä¸€ä¸ªæ’æ¡©çš„åº”ç”¨ç¨‹åºï¼ˆæˆ‘ä»¬çš„æ¸¸æˆï¼‰å¯åŠ¨å¹¶å°è¯•è¿æ¥åˆ°Tracy Workerã€‚
4.  **æ•°æ®æ¥æ”¶ï¼š** ä¸€æ—¦è¿æ¥ï¼Œ[Tracy Client](02_tracy_client__instrumentation__.md)æŒç»­é€šè¿‡ç½‘ç»œå‘Workerå‘é€åŸå§‹æ€§èƒ½åˆ†ææ•°æ®ï¼ˆæ—¶é—´æˆ³ã€zone IDã€æ¶ˆæ¯ï¼‰ã€‚
5.  **å¤„ç†å’Œå­˜å‚¨ï¼š** Tracy Workeræ¥æ”¶è¿™äº›åŸå§‹å­—èŠ‚ï¼Œå°†å®ƒä»¬ååºåˆ—åŒ–ä¸ºæœ‰æ„ä¹‰çš„äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼Œå¸¦æœ‰å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´å’Œæºä½ç½®çš„`ZoneEvent`ï¼‰ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨å…¶å†…éƒ¨å†…å­˜ç»“æ„ä¸­ã€‚å®ƒè¿˜è·Ÿè¸ªå†…å­˜ä½¿ç”¨å’Œçº¿ç¨‹åç§°ç­‰å†…å®¹ã€‚
6.  **è¿›åº¦æ˜¾ç¤ºï¼š** åœ¨å¤„ç†æ—¶ï¼ŒWorkerå‘æ§åˆ¶å°æ‰“å°å®æ—¶ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚ä¼ è¾“é€Ÿåº¦ã€å†…å­˜ä½¿ç”¨ï¼‰ï¼Œä»¥é€šçŸ¥ç”¨æˆ·ã€‚
7.  **ç»ˆæ­¢å’Œä¿å­˜ï¼š** å½“æˆ‘ä»¬åœæ­¢`tracy-capture`å®ç”¨ç¨‹åºæ—¶ï¼ˆä¾‹å¦‚ï¼ŒæŒ‰`Ctrl+C`ï¼‰ï¼ŒWorkerå®Œæˆå¤„ç†ä»»ä½•å‰©ä½™æ•°æ®ï¼Œç„¶åå°†å…¶æ•´ä¸ªå†…éƒ¨æ•°æ®é›†åºåˆ—åŒ–åˆ°æŒ‡å®šçš„`.tracy`æ–‡ä»¶ä¸­å¹¶ä¿å­˜åˆ°ç£ç›˜ã€‚

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant YourApp as æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼ˆTracy Clientï¼‰
    participant CaptureApp as tracy-captureï¼ˆTracy Workerï¼‰
    participant Network as ç½‘ç»œ
    participant LocalStorage as æœ¬åœ°å­˜å‚¨

    User->>CaptureApp: å¯åŠ¨`tracy-capture -o trace.tracy`
    Note over CaptureApp: åˆå§‹åŒ–å¹¶å¼€å§‹ç›‘å¬
    YourApp->>Network: è¿æ¥åˆ°CaptureApp
    Network-->>CaptureApp: å»ºç«‹è¿æ¥
    Note over YourApp, CaptureApp: æ€§èƒ½åˆ†æä¼šè¯å¼€å§‹
    loop æ•°æ®æ”¶é›†
        YourApp->>Network: å‘é€åŸå§‹æ€§èƒ½åˆ†ææ•°æ®ï¼ˆZoneBeginã€ZoneEndç­‰ï¼‰
        Network->>CaptureApp: ä¼ é€’åŸå§‹æ•°æ®
        Note over CaptureApp: å¤„ç†ã€ååºåˆ—åŒ–å¹¶å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­
        CaptureApp->>User: æ˜¾ç¤ºå®æ—¶è¿›åº¦ç»Ÿè®¡
    end
    User->>CaptureApp: æŒ‰Ctrl+Cåœæ­¢
    Note over CaptureApp: æ–­å¼€è¿æ¥ï¼Œå®Œæˆæ•°æ®
    CaptureApp->>LocalStorage: å°†ç»„ç»‡å¥½çš„æ€§èƒ½åˆ†ææ•°æ®ä¿å­˜åˆ°trace.tracy
    CaptureApp-->>User: æŠ¥å‘Šä¿å­˜çŠ¶æ€
```

### ä»£ç 

`tracy-capture`å®ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªä½¿ç”¨`tracy::Worker`ç±»çš„å•ç‹¬åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥åœ¨`capture/src/capture.cpp`ä¸­æ‰¾åˆ°å…¶`main`å‡½æ•°ã€‚

1.  **Workerå®ä¾‹åŒ–ï¼š**
    `tracy-capture`å®ç”¨ç¨‹åºçš„æ ¸å¿ƒæ˜¯åˆ›å»º`tracy::Worker`ç±»çš„å®ä¾‹ã€‚è¿™ä¸ª`Worker`å¯¹è±¡å¤„ç†ç½‘ç»œé€šä¿¡å’Œæ•°æ®å¤„ç†çš„æ‰€æœ‰ç¹é‡å·¥ä½œã€‚

    ```cpp
    // --- æ–‡ä»¶ï¼šcapture/src/capture.cpp ---
    // ...
    #include "../../server/TracyWorker.hpp" // åŒ…å«Workerå¤´æ–‡ä»¶
    // ...
    int main( int argc, char** argv )
    {
        // ... (åœ°å€ã€ç«¯å£ã€è¾“å‡ºæ–‡ä»¶ç­‰çš„å‚æ•°è§£æ) ...
    
        printf( "Connecting to %s:%i...", address, port );
        fflush( stdout );
    
        // åˆ›å»ºTracy Workerå®ä¾‹
        tracy::Worker worker( address, port, memoryLimit );
    
        // ... (å¤„ç†æ¡æ‰‹çŠ¶æ€å¹¶ç­‰å¾…æ•°æ®) ...
    }
    ```
    è¿™é‡Œï¼Œ`tracy::Worker worker( address, port, memoryLimit );`åˆ›å»ºWorkerã€‚å®ƒè¢«èµ‹äºˆè¦ç›‘å¬çš„IP `address`å’Œ`port`ï¼Œä»¥åŠå¯é€‰çš„`memoryLimit`ï¼Œç”¨äºå®ƒå¯ä»¥ä½¿ç”¨å¤šå°‘RAMã€‚

2.  **æ•°æ®å¤„ç†å¾ªç¯ï¼š**
    ä¸€æ—¦è¿æ¥ï¼Œ`tracy-capture`ç¨‹åºè¿›å…¥ä¸€ä¸ªå¾ªç¯ï¼Œä¸æ–­æ£€æŸ¥workeræ˜¯å¦ä»ç„¶è¿æ¥ã€‚åœ¨è¿™ä¸ªå¾ªç¯å†…ï¼Œ`tracy::Worker`å¯¹è±¡ï¼ˆåœ¨å…¶è‡ªå·±çš„åå°çº¿ç¨‹ä¸­è¿è¡Œï¼‰å¤„ç†ä¼ å…¥çš„æ•°æ®ã€‚

    ```cpp
    // --- æ–‡ä»¶ï¼šcapture/src/capture.cpp ---
    // ...
    // å¾ªç¯ç›´åˆ°workeræ–­å¼€è¿æ¥
    while( worker.IsConnected() )
    {
        // æ£€æŸ¥ç”¨æˆ·ä¸­æ–­ï¼ˆCtrl+Cï¼‰
        if( s_disconnect.load( std::memory_order_relaxed ) )
        {
            worker.Disconnect(); // å‘Šè¯‰workeræ–­å¼€è¿æ¥
            s_disconnect.store(false, std::memory_order_relaxed );
            break;
        }
    
        // è·å–å¹¶æ˜¾ç¤ºå®æ—¶ç»Ÿè®¡ä¿¡æ¯ï¼Œå¦‚Mbpsã€å‹ç¼©æ¯”ã€å†…å­˜ä½¿ç”¨
        // ... (æ˜¾ç¤ºè¿›åº¦çš„ä»£ç ) ...
    
        std::this_thread::sleep_for( std::chrono::milliseconds( 100 ) ); // çŸ­æš‚ç¡çœ 
    }
    // ...
    ```
    æ³¨æ„ï¼Œ`while`å¾ªç¯ä¸»è¦å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ˆ`s_disconnect`ï¼‰å’Œæ˜¾ç¤ºè¿›åº¦ã€‚`worker`å¯¹è±¡æœ¬èº«åœ¨åå°æŒç»­æ¥æ”¶å’Œå¤„ç†æ•°æ®ã€‚

3.  **ä¿å­˜è·Ÿè¸ªï¼š**
    åœ¨`while`å¾ªç¯ä¹‹åï¼ˆå½“æ•è·åœæ­¢æ—¶ï¼‰ï¼ŒWorkerç´¯ç§¯çš„æ•°æ®è¢«å†™å…¥æŒ‡å®šçš„`.tracy`æ–‡ä»¶ã€‚

    ```cpp
    // --- æ–‡ä»¶ï¼šcapture/src/capture.cpp ---
    // ...
    printf( "\nFrames: %" PRIu64 "\nTime span: %s\nZones: %s\nElapsed time: %s\nSaving trace...",
        // ... (æ‰“å°æ‘˜è¦ç»Ÿè®¡) ...
        );
    fflush( stdout );
    
    // æ‰“å¼€è¾“å‡ºæ–‡ä»¶è¿›è¡Œå†™å…¥
    auto f = std::unique_ptr<tracy::FileWrite>( tracy::FileWrite::Open( output, tracy::FileCompression::Zstd, 3, 4 ) );
    if( f )
    {
        worker.Write( *f, false ); // å‘Šè¯‰workerå°†æ‰€æœ‰æ”¶é›†çš„æ•°æ®å†™å…¥æ–‡ä»¶
        AnsiPrintf( ANSI_GREEN ANSI_BOLD, " done!\n" );
        f->Finish();
        // ... (æ‰“å°å‹ç¼©ç»Ÿè®¡) ...
    }
    else
    {
        AnsiPrintf( ANSI_RED ANSI_BOLD, " failed!\n");
    }
    // ...
    ```
    `worker.Write(*f, false);`è°ƒç”¨è‡³å…³é‡è¦ã€‚å®ƒå‘Šè¯‰`tracy::Worker`å°†å…¶æ‰€æœ‰ç»„ç»‡å¥½çš„å†…å­˜ä¸­æ€§èƒ½åˆ†ææ•°æ®åºåˆ—åŒ–åˆ°`FileWrite`å¯¹è±¡ä¸­ï¼Œç„¶åè¯¥å¯¹è±¡å¤„ç†å°†å…¶ä¿å­˜åˆ°`.tracy`æ–‡ä»¶ã€‚

é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œä¸»[Tracy Viewï¼ˆåˆ†æå™¨GUIï¼‰](01_tracy_view__profiler_gui__.md)åœ¨è¿æ¥åˆ°å®æ—¶å®¢æˆ·ç«¯æ—¶ä¹Ÿåœ¨å†…éƒ¨åŒ…å«ä¸€ä¸ª`tracy::Worker`å¯¹è±¡ã€‚è¿™æ„å‘³ç€GUIæœ¬èº«æ‰§è¡Œç›¸åŒçš„æ•°æ®æ¥æ”¶å’Œå¤„ç†ä»»åŠ¡ã€‚`tracy-capture`å®ç”¨ç¨‹åºåªæ˜¯ä¸€ä¸ªä¸“æ³¨äºå°†æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶çš„ç‹¬ç«‹ç‰ˆæœ¬ã€‚

```cpp
// --- æ¥è‡ªï¼šprofiler/src/profiler/TracyView.cppï¼ˆç®€åŒ–ï¼‰---
// è¿æ¥åˆ°å®æ—¶å®¢æˆ·ç«¯æ—¶çš„æ„é€ å‡½æ•°
View::View( void(*cbMainThread)(const std::function<void()>&, bool), const char* addr, uint16_t port, SetTitleCallback stcb, SetScaleCallback sscb, AttentionCallback acb, AchievementsMgr* amgr )
    : m_worker( addr, port, s_config.memoryLimit == 0 ? -1 : ( s_config.memoryLimitPercent * tracy::GetPhysicalMemorySize() / 100 ) )
    // ... å…¶ä½™åˆå§‹åŒ– ...
{
    // m_workeræˆå‘˜åœ¨è¿™é‡Œåˆå§‹åŒ–ï¼Œè¿æ¥åˆ°å®¢æˆ·ç«¯
    // ç„¶åå®ƒåœ¨åå°çº¿ç¨‹ä¸­æŒç»­æ¥æ”¶å’Œå¤„ç†æ•°æ®ã€‚
}

// æ‰“å¼€ä¿å­˜çš„è·Ÿè¸ªæ–‡ä»¶æ—¶çš„æ„é€ å‡½æ•°
View::View( void(*cbMainThread)(const std::function<void()>&, bool), FileRead& f, SetTitleCallback stcb, SetScaleCallback sscb, AttentionCallback acb, AchievementsMgr* amgr )
    : m_worker( f ) // ç”¨è·Ÿè¸ªæ–‡ä»¶åˆå§‹åŒ–Tracy Worker
    // ... å…¶ä½™åˆå§‹åŒ– ...
{
    // åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œm_workerä»æ–‡ä»¶è€Œä¸æ˜¯å®æ—¶å®¢æˆ·ç«¯åŠ è½½æ•°æ®ã€‚
}
```
æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œ`tracy::Worker`æ˜¯ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œæ— è®ºæˆ‘ä»¬æ˜¯ä½¿ç”¨åƒ`tracy-capture`è¿™æ ·çš„ä¸“ç”¨å®ç”¨ç¨‹åºæ•è·æ•°æ®ï¼Œè¿˜æ˜¯åœ¨GUIä¸­å®æ—¶æŸ¥çœ‹å®ƒã€‚

## ç»“è®º

æˆ‘ä»¬ç°åœ¨å·²ç»æ­ç¤ºäº†**Tracy Worker**çš„è§’è‰²ï¼Œè¿™æ˜¯ä»æˆ‘ä»¬æ’æ¡©çš„åº”ç”¨ç¨‹åºæ¥æ”¶ã€å¤„ç†å’Œç»„ç»‡åŸå§‹æ€§èƒ½æ•°æ®çš„å…³é”®"å¤§è„‘"ã€‚

æˆ‘ä»¬å·²ç»çœ‹åˆ°åƒ`tracy-capture`è¿™æ ·çš„ç‹¬ç«‹å®ç”¨ç¨‹åºå¦‚ä½•==ä½¿ç”¨Workerå°†å®æ—¶æ€§èƒ½åˆ†æä¼šè¯ä¿å­˜åˆ°`.tracy`æ–‡ä»¶ä»¥ä¾›ä»¥ååˆ†æ==ï¼Œä»¥åŠ[Tracy Viewï¼ˆåˆ†æå™¨GUIï¼‰](01_tracy_view__profiler_gui__.md)å¦‚ä½•==åœ¨å†…éƒ¨åˆ©ç”¨`tracy::Worker`è¿›è¡Œå®æ—¶è¿æ¥==ã€‚

æ‰€æœ‰è¿™äº›æ•°æ®ä¼ è¾“ï¼Œä»[Tracy Client](02_tracy_client__instrumentation__.md)åˆ°Tracy Workerï¼Œéƒ½ä¾èµ–äºç»“æ„åŒ–çš„é€šä¿¡æ–¹å¼ã€‚åœ¨[ä¸‹ä¸€ç« ](04_tracy_protocol___sockets_.md)ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨**Tracyåè®®ä¸å¥—æ¥å­—**ï¼Œä»¥äº†è§£ç”¨äºè¿™ç§é«˜æ•ˆé€šä¿¡çš„è¯­è¨€å’Œé€šé“

[ä¸‹ä¸€ç« ï¼šTracyåè®®ä¸å¥—æ¥å­—](04_tracy_protocol___sockets_.md)

